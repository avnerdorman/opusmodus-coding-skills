Opusmodus                                                                 add-sawtooth-waves   1

add-sawtooth-waves niter res freq amplitude
                                  &key phase modulation
[Function]

Arguments and Values:
niter                   a number representing the iteration of the wave.
res                     resolution and length of the wave.
freq                    a number representing the frequency of the wave.
amplitude               a number representing the amplitude of the wave.
                        or a sequence serving as alternating amplitudes.
phase                   a number representing the phase. The default is NIL.
modulation              if NIL no modulation, otherwise a wave. The default is NIL.


Description:

ADD-SAWTOOTH-WAVES are generated by GEN-SAWTOOTH niter times, halving freq
at each iteration. Arguments following niter are the same as in GEN-SAWTOOTH.

(add-sawtooth-waves 4 24 4 0.6)
=> (-3.0 -2.6125 -2.2249999999999996 -1.8375
    -1.4500000000000002 -1.0625 -1.875
      -1.4875000000000003 -1.1 -0.7125 . . .)


Examples:

The term niter is an abbreviation for N iterations. It is a form of frequency control
making possible a halving of frequency at each iteration. This is a feature of the famous
Poincare oscillation or section, which is a common feature of harmonic and dynamic
systems. As with the GEN-SAWTOOTH examples the following demonstrate how the addition
of :modulation and :phase can have a rich impact on the distortions of the waveform.
Opusmodus                                            add-sawtooth-waves   2

(list-plot (add-sawtooth-waves 4 64 4 0.6))




(list-plot
 (add-sawtooth-waves 4 120 1 0.6
  :modulation (gen-sawtooth 120 1 0.4 :phase 60)))
Opusmodus                                              add-sawtooth-waves   3

(list-plot
 (add-sawtooth-waves 4 120 4 0.6
  :modulation (gen-sine 120 1 0.4 :phase 60)))




(list-plot
 (add-sawtooth-waves 4 120 4 0.6
  :modulation (gen-sawtooth 120 1 '(0.5 0.2 0.1) :phase 60)))
Opusmodus                                                          add-sawtooth-waves   4

Here below there's a clear example of how alternating amplitude values can affect the
wave output when the vectors are mapped to pitches.

(vector-to-pitch
 '(g3 g5)
  (add-sawtooth-waves 4 64 4 0.6
   :modulation (gen-sine 64 1 '(0.5 0.2 0.1) :phase 60)))
=> (g3 gs3 a3 b3 b3 b3 d4 d4 d4 f4 e4 f4 gs4 g4 g4 ds4 d4 ds4
    f4 f4 f4 fs4 fs4 g4 fs4 gs4 a4 g4 as4 b4 g4 b4 cs5 gs4 cs5
    d4 a4 cs4 e4 b4 e4 fs4 d5 fs4 a4 e4 a4 c5 gs4 cs5 gs4 d5
    as4 c5 d5 d5 ds5 cs4 g5 g5 a4 ds4 cs4 as4)
Opusmodus                                                           add-sawtooth-waves   5

The example score is a powerful example of how this function can produce captivating
results. Notice in particular how the rhythms and sections have been devised.


Score Example:
(setf size 120)
(setf vector
     (add-sawtooth-waves
      4 64 4 0.6
      :modulation (gen-sawtooth size 1 '(0.5 0.4 0.3 0.6)
      :modulation (gen-sawtooth size 1 0.3 :phase 180))))

(setf pitches (gen-divide 4 (vector-to-pitch '(g1 g6) vector)))
(setf transpose (pitch-transpose -12 pitches))
(setf section (rnd-unique (/ (length pitches) 2)
                          (gen-integer 0 (1- (length pitches)))))

(setf variants (pitch-variant transpose :variant '? :section section))
(setf dur1 (rnd-sample (- size 9) '(s e s s)))
(setf dur2 '(s s s s s s s s q))
(setf duration (flatten (list dur1 dur2)))
(setf dur-rh (span pitches duration))
(setf dur-lh (span variants duration))
(setf dynamics '(p mp mf f ff fff))

(def-score add-sawtooth
           (:key-signature 'chromatic
            :time-signature '(4 4)
            :tempo 100)

(right-hand
 :length dur-rh
 :pitch pitches
 :velocity (rnd-sample size dynamics)
 :sound 'gm
 :channel 1
 :program 'acoustic-grand-piano)

(left-hand
 :length dur-lh
 :pitch variants
 :velocity (rnd-sample size dynamics)))

(display-midi (compile-score 'add-sawtooth))
