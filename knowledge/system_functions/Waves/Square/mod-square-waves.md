Opusmodus                                                                    mod-square-waves   1

mod-square-waves niter res freq amplitude
                           &key phase modulation variant
[Function]

Arguments and Values:
niter                   a number representing the iteration of the wave.
res                     resolution and length of the wave.
freq                    a number representing the frequency of the wave.
amplitude               a number representing the amplitude of the wave.
                        or a sequence serving as alternating amplitudes.
phase                   a number repesenting the phase. The default is NIL.
modulation              if NIL no modulation, otherwise a wave. The default is NIL.
variant                 1 or 2. The default is 1.


Description:

Modulating iterations of square-waves as generated by GEN-SQUARE niter times.
Arguments following niter are the same as in GEN-SQUARE.

(mod-square-waves 4 32 4 0.6)
=> (0.6 0.6 0.6 0.6 -0.6 -0.6 0.6 -0.6 -0.6
    -0.6 -0.6 0.6 -0.6 0.6 -0.6 -0.6 0.6 0.6
    0.6 -0.6 -0.6 -0.6 -0.6 -0.6 -0.6 0.6 0.6
    0.6 0.6 0.6 -0.6 -0.6)


Examples:

The term niter is an abbreviation for N iterations. It is a form of frequency
control making possible a halving of frequency at each iteration. This is a feature of the
famous Poincare oscillation or section, which is a common feature of harmonic and dynamic
systems. As with the GEN-SQUARE examples the following demonstrate how the addition of
:modulation and :phase can have a rich impact on the distortions of the waveform.
Opusmodus                                          mod-square-waves   2

(list-plot (mod-square-waves 1 120 4 0.6))




(list-plot
 (mod-square-waves 1 120 1 0.6
  :modulation (gen-square 120 1 0.4 :phase 60)))
Opusmodus                                                          mod-square-waves   3

In the example below a new keyword is introduced :variant. This has two positions 1
and 2 of which 1 is the default.

(list-plot
 (mod-square-waves 50 120 4 0.3
  :modulation (gen-square 120 1 0.4)))
Opusmodus                                                              mod-square-waves      4

(list-plot
 (mod-square-waves 50 120 7 0.3
 :modulation (gen-square 120 7 0.4) :variant 2))




Here below there's a clear example of how alternating amplitude values can affect the wave
output when the vectors are mapped to pitches.

(vector-to-pitch
 '(g3 g5)
 (mod-square-waves 4 64 4 0.6
  :modulation (gen-square 64 7 '(0.5 0.2 0.1) :phase 60)))
=> (g5 g5 g5 g5 g5 g5 g5 g5 g3 g3 g3 g5 g5 g3 g3 g3 g3
    g3 g3 g3 g3 g3 g5 g5 g5 g5 g5 g5 g5 g3 g3 g3 g5 g5
    g5 g5 g5 g3 g3 g3 g3 g3 g3 g5 g3 g3 g5 g5 g3 g3 g3
    g5 g3 g5 g5 g5 g5 g5 g5 g5 g3 g3 g3 g3)
Opusmodus                                                               mod-square-waves   5

These complex visual gestures can be used most effectively to structure distinctive patterns
in pitch, transposition and dynamics parameters. The score example amply demonstrates this.


Score Example:
(setf size 120)
(setf vector
      (mod-square-waves
       12 size 4 0.9
       :modulation
       (gen-square size 7 '(0.5 0.4 0.3 0.6)
        :modulation (gen-square size 1 0.3 :phase 180))
       :variant 2))

(setf pitches (gen-divide 4 (vector-to-pitch '(g1 g6) vector)))
(setf transp (rnd-sample size '(-13 -12 -11 -6 -1 1 6 11 12 13)))
(setf transpose (pitch-transpose transp pitches))

(setf section
      (rnd-unique (/ (length pitches) 2)
                  (gen-integer 0 (1- (length pitches)))))

(setf variants (pitch-variant transpose :variant '? :section section))
(setf dur1 (flatten (rnd-sample (- size 9) '(s e s s (3e = =)))))
(setf dur2 '(s s s s s s s s q))
(setf duration (flatten (list dur1 dur2)))
(setf time (span pitches duration))
(setf dynamics '(p mp mf f ff))

(def-score mod-square
             (:key-signature 'chromatic
              :time-signature (get-time-signature time)
              :tempo 100
              :layout (piano-solo-layout 'rh 'lh))

   (rh
      :length duration
      :pitch pitches
      :velocity (rnd-sample size dynamics)
      :sound 'gm
      :channel 1
      :program 'acoustic-grand-piano)

   (lh
      :length duration
      :pitch variants
      :velocity (rnd-sample size dynamics)))
