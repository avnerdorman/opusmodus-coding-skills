# Function Documentation: Pattern Arpeggiator & List Utilities

This document covers the set of custom functions designed for arpeggiating pitch lists using random or fixed integer-based patterns, as well as several utility functions for list modification.

---

## **Function:** `pattern-arpeggiator`

**Category:** Patterns / Arpeggiation  
**Description:** Applies a randomized or fixed pattern mapping to a list of source groups.

### Syntax

```lisp
(pattern-arpeggiator midi-lists pattern-set repetitions &optional fixed-pattern)
```

### Arguments

- **`midi-lists`**: A list of source lists (e.g., sequences of chords as MIDI notes or integer representations).
- **`pattern-set`**: A list of base patterns, where each pattern is a sequence of 1-based indices (1, 2, 3...) referencing the source lists.
- **`repetitions`**: The number of times to repeat the arpeggiation cycle per each list in `midi-lists`.
- **`&optional fixed-pattern`**: A specific 1-based permutation sequence. If omitted, the function automatically generates a single Fisher-Yates random shuffle of the first pattern in the `pattern-set`.

### Description

This is the core function for creating pattern-based arpeggios out of chord or pitch groupings. The function interprets values in the `pattern-set` as 1-based indices referring to elements in a `midi-list`.

Crucially, the raw numbers in `pattern-set` are first routed through a primary permutation mapping. By default, this primary mapping is randomly generated by shuffling the first sublist of the `pattern-set`. If you provide a `fixed-pattern`, the function will route through that limit instead.

### Examples

```lisp
;; Example with a randomly generated pattern
(pattern-arpeggiator '((64 67 71)) '((1 2 3) (3 2 1)) 2)

;; Example utilizing a specific fixed pattern
(pattern-arpeggiator
 '((57 59 60 64))                ;; midi-lists
 '((1 2 3 4) (1 2 3 4 3 4))      ;; pattern-set
 2                               ;; repetitions
 '(4 2 1 3))                     ;; fixed mapping constraint
```

---

## **Function:** `run-pattern-arpeggiator`

**Category:** Patterns / Arpeggiation  
**Description:** Convenience wrapper for `pattern-arpeggiator` converting numeric output back into native Opusmodus pitches.

### Syntax

```lisp
(run-pattern-arpeggiator midi-lists pattern-set repetitions &optional fixed-pattern)
```

### Description

Wrapper around `pattern-arpeggiator` to automatically invoke `midi-to-pitch` on its output list.

### Examples

```lisp
(run-pattern-arpeggiator
 '((57 59 60 64 66 67) (57 62 64 66 67))
 '((1 2 3 4 5) (1 2 3 4 5 4 5))
 4 '(4 2 1 3 5))
```

---

## **Function:** `modify-list-steps`

**Category:** List Management / Step Manipulation  
**Description:** Iteratively mutates a list by enforcing 1s and 0s based on a modulus-3 rule.

### Syntax

```lisp
(modify-list-steps lst)
```

### Arguments

- **`lst`**: The source linear list.

### Description

Successively steps sequentially forwards through a flat list, actively mutating each element based on its 0-based index:

- If `index mod 3 == 0`, it enforces `1`
- If `index mod 3 == 1`, it enforces `0`
- If `index mod 3 == 2`, the element preserves its state.

It records intermediate changes to the data. It returns the complete history of these changes in order, producing a list of modified lists.

### Examples

```lisp
(modify-list-steps '(1 1 1 1 1 0 0 0 0 0 0 0))
```

---

## **Function:** `split-into-sublists`

**Category:** List Management  
**Description:** Recursively chunks a flat list into evenly sized sublists.

### Syntax

```lisp
(split-into-sublists lst &optional (size 12))
```

### Arguments

- **`lst`**: The list to continuously chunk.
- **`&optional size`** (default `12`): The total length limit per independent sublist.

### Examples

```lisp
(split-into-sublists '(a b c d e f g h i j k l m n) 7)
;; => ((a b c d e f g) (h i j k l m n))
```

---

## **Function:** `remove-elements-from-even-sublists`

**Category:** List Management  
**Description:** Automatically loops through a list of sublists, truncating any even-indexed entry.

### Syntax

```lisp
(remove-elements-from-even-sublists lst)
```

### Arguments

- **`lst`**: An overarching series composed of respective sublists.

### Description

Taking a 1-based index (where the 2nd, 4th, 6th... sublists are even), this function targets even lists and instantly shortens them by erasing precisely their final 2 elements using `butlast`.

### Examples

```lisp
(remove-elements-from-even-sublists '((1 2 3 4 5) (1 2 3 4 5) (1 2 3 4 5)))
;; => ((1 2 3 4 5) (1 2 3) (1 2 3 4 5))
```
